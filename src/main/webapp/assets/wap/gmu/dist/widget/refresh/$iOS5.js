(function(e,t,n){e.Refresh.register("iOS5",{_init:function(){var e=this,n=e._options,r=e.$el;r.css({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),n.topOffset=n.$upElem?n.$upElem.height():0,n.iScroll=e._getiScroll(),r.get(0).scrollTop=n.topOffset,r.on("touchstart touchmove touchend",t.proxy(e._eventHandler,e))},_changeStyle:function(e,t){var n=this,r=n._options,i=r.refreshInfo[e];n.origin(e,t);switch(t){case"loaded":i.$icon.addClass("ui-refresh-icon"),r._actDir="";break;case"beforeload":i.$label.html("松开立即加载"),i.$icon.addClass("ui-refresh-flip");break;case"loading":i.$icon.removeClass().addClass("ui-loading")}return n},_scrollStart:function(e){var t=this,n=t._options,r=n.topOffset,i=n.$upElem,s=t.$el.get(0),o=function(){clearTimeout(n.topOffsetTimer),i&&i.length&&s.scrollTop<=r&&!n._upRefreshed&&(s.scrollTop=r)};return t.trigger("scrollstart",e),t._enableScroll()._bindScrollStop(s,o),n.maxScrollY=s.offsetHeight-s.scrollHeight,n._scrollFn=o,t},_scrollMove:function(){var e=this,t=e._options,n=t.$upElem&&t.$upElem.length,r=t.$downElem&&t.$downElem.length,i=e.$el.get(0),s=t.threshold||5;e._scrollMove=function(o){var u=t.maxScrollY,a=i.scrollTop,f=t.lastMoveY||a,l=t._upRefreshed,c=t._downRefreshed,h=e._status("up"),p=e._status("down");if(n&&!h||r&&!p)return;return t.iScroll.deltaY=a-f,p&&r&&!c&&-a<u-s?e._setMoveState("down","beforeload","pull"):p&&r&&c&&-a>u-s&&-a!==u?e._setMoveState("down","loaded","restore"):h&&n&&!l&&-a>s?e._setMoveState("up","beforeload","pull"):h&&n&&l&&-a<s&&a&&e._setMoveState("up","loaded","restore"),t.lastMoveY=a,t._moved=!0,e.trigger("scrollmove",o,a,a-f)},e._scrollMove.apply(e,arguments)},_scrollEnd:function(e){var n=this,r=n._options,i=n.$el.get(0),s=r.topOffset,o=r._actDir,u=r._restoreDir;return(u=="up"||i.scrollTop<=s)&&!o&&r._moved&&(n._options.topOffsetTimer=setTimeout(function(){t(i).off("scroll",r._scrollFn),i.scrollTop=s},800)),o&&n._status(o)&&(n._setStyle(o,"loading"),n._loadingAction(o,"pull")),r._moved=!1,n.trigger("scrollend",e)},_enableScroll:function(){var e=this,t=e.$el.get(0),n=t.scrollTop;return n<=0&&(t.scrollTop=1),n+t.offsetHeight>=t.scrollHeight&&(t.scrollTop=t.scrollHeight-t.offsetHeight-1),e},_bindScrollStop:function(e,n){var r=this,i=t(e);return i.off("scroll",r._options._scrollFn).on("scroll",t.debounce(100,function(){i.off("scroll",arguments.callee).one("scroll",n)},!1)),r},_getiScroll:function(){var e=this,t=e.$el,n=t[0];return{el:n,deltaY:0,scrollTo:function(e,r,i){i&&(e=n.scrollTop+e),t.css({"-webkit-transition-property":"scrollTop","-webkit-transition-duration":e+"ms"}),n.scrollTop=e},disable:function(n){n&&e.destroy(),t.css("overflow","hidden")},enable:function(){t.css("overflow","scroll")}}},_setMoveState:function(e,t,n){var r=this,i=r._options;return r._setStyle(e,t),i["_"+e+"Refreshed"]=n=="pull",i._actDir=n=="pull"?e:"",i._restoreDir=e=="up"&&n=="restore"?e:"",r},_eventHandler:function(e){var t=this;switch(e.type){case"touchstart":t._scrollStart(e);break;case"touchmove":t._scrollMove(e);break;case"touchend":t._scrollEnd(e)}},afterDataLoading:function(e){var t=this,n=t._options,e=e||n._actDir;return n["_"+e+"Refreshed"]=!1,e=="up"&&(t.$el.get(0).scrollTop=n.topOffset),t.origin(e)}})})(gmu,gmu.$);