(function(e,t){var n=0;gmu.define("Suggestion",{options:{historyShare:!0,confirmClearHistory:!0,autoClose:!1},template:{wrapper:'<div class="ui-suggestion"><div class="ui-suggestion-content"></div><div class="ui-suggestion-button"><span class="ui-suggestion-clear">清除历史记录</span><span class="ui-suggestion-close">关闭</span></div></div>'},_initDom:function(){var t=this,r=t.getEl().attr("autocomplete","off"),i=r.parent(".ui-suggestion-mask");return i.length?t.$mask=i:r.wrap(t.$mask=e('<div class="ui-suggestion-mask"></div>')),t.$mask.append(t.tpl2html("wrapper")),t.$wrapper=t.$mask.find(".ui-suggestion").prop("id","ui-suggestion-"+n++),t.$content=t.$wrapper.css("top",r.height()+(t.wrapperTop=parseInt(t.$wrapper.css("top"),10)||0)).find(".ui-suggestion-content"),t.$btn=t.$wrapper.find(".ui-suggestion-button"),t.$clearBtn=t.$btn.find(".ui-suggestion-clear"),t.$closeBtn=t.$btn.find(".ui-suggestion-close"),t.trigger("initdom")},_bindEvent:function(){var t=this,n=t.getEl(),r=t.eventNs;return t._options.autoClose&&e(document).on("tap"+r,function(n){!e.contains(t.$mask.get(0),n.target)&&t.hide()}),n.on("focus"+r,function(){!t.isShow&&t._showList().trigger("open")}),n.on("input"+r,function(){t._showList()}),t.$clearBtn.on("click"+r,function(){t.history(null)}).highlight("ui-suggestion-highlight"),t.$closeBtn.on("click"+r,function(){t.getEl().blur(),t.hide().trigger("close")}).highlight("ui-suggestion-highlight"),t},_create:function(){var t=this,r=t._options,i=r.historyShare;return r.container&&(t.$el=e(r.container)),t.key=i?(e.type(i)==="boolean"?"":i+"-")+"SUG-Sharing-History":t.getEl().attr("id")||"ui-suggestion-"+n++,t.separator=encodeURIComponent(","),t._initDom()._bindEvent(),t},_showList:function(){var t=this,n=t.value(),r;return n?t.trigger("sendrequest",n,e.proxy(t._render,t),e.proxy(t._cacheData,t)):(r=t._localStorage())?t._render(n,r.split(t.separator)):t.hide(),t},_render:function(t,n){this.trigger("renderlist",n,t,e.proxy(this._fillWrapper,this))},_fillWrapper:function(e){return this.$clearBtn[this.value()?"hide":"show"](),e?(this.$content.html(e),this.show()):this.hide(),this},_localStorage:function(n){var r=this,i=r.key,s=r.separator,o,u;try{o=t.localStorage;if(n===undefined)return o[i];n===null?o[i]="":n&&(u=o[i]?o[i].split(s):[],~e.inArray(n,u)||(u.unshift(n),o[i]=u.join(s)))}catch(a){console.log(a.message)}return r},_cacheData:function(e,t){return this.cacheData||(this.cacheData={}),t!==undefined?this.cacheData[e]=t:this.cacheData[e]},value:function(){return this.getEl().val()},history:function(e){var n=this,r=e!==null||function(){return n._localStorage(null).hide()};return e===null?n._options.confirmClearHistory?t.confirm("清除全部查询历史记录？")&&r():r():n._localStorage(e)},show:function(){return this.isShow?this:(this.$wrapper.show(),this.isShow=!0,this.trigger("show"))},hide:function(){return this.isShow?(this.$wrapper.hide(),this.isShow=!1,this.trigger("hide")):this},destroy:function(){var t=this,n=t.getEl(),r=t.ns;return t.trigger("destroy"),n.off(r),t.$mask.replaceWith(n),t.$clearBtn.off(r),t.$closeBtn.off(r),t.$wrapper.children().off().remove(),t.$wrapper.remove(),t._options.autoClose&&e(document).off(r),this.destroyed=!0,t}})})(gmu.$,window);