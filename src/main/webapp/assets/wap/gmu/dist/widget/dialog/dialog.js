(function(e,t,n){var r={close:'<a class="ui-dialog-close" title="关闭"><span class="ui-icon ui-icon-delete"></span></a>',mask:'<div class="ui-mask"></div>',title:'<div class="ui-dialog-title"><h3><%=title%></h3></div>',wrap:'<div class="ui-dialog"><div class="ui-dialog-content"></div><% if(btns){ %><div class="ui-dialog-btns"><% for(var i=0, length=btns.length; i<length; i++){var item = btns[i]; %><a class="ui-btn ui-btn-<%=item.index%>" data-key="<%=item.key%>"><%=item.text%></a><% } %></div><% } %></div> '};e.define("Dialog",{options:{autoOpen:!0,buttons:null,closeBtn:!0,mask:!0,width:300,height:"auto",title:null,content:null,scrollMove:!0,container:null,maskClick:null,position:null},getWrap:function(){return this._options._wrap},_init:function(){var e=this,n=e._options,i,s=0,o=t.proxy(e._eventHandler,e),u={};e.on("ready",function(){n._container=t(n.container||document.body),(n._cIsBody=n._container.is("body"))||n._container.addClass("ui-dialog-container"),u.btns=i=[],n.buttons&&t.each(n.buttons,function(e){i.push({index:++s,text:e,key:e})}),n._mask=n.mask?t(r.mask).appendTo(n._container):null,n._wrap=t(t.parseTpl(r.wrap,u)).appendTo(n._container),n._content=t(".ui-dialog-content",n._wrap),n._title=t(r.title),n._close=n.closeBtn&&t(r.close).highlight("ui-dialog-close-hover"),e.$el=e.$el||n._content,e.title(n.title),e.content(n.content),i.length&&t(".ui-dialog-btns .ui-btn",n._wrap).highlight("ui-state-hover"),n._wrap.css({width:n.width,height:n.height}),t(window).on("ortchange",o),n._wrap.on("click",o),n._mask&&n._mask.on("click",o),n.autoOpen&&e.open()})},_create:function(){var e=this._options;this._options.setup&&(e.content=e.content||this.$el.show(),e.title=e.title||this.$el.attr("title"))},_eventHandler:function(e){var n=this,r,i,s=n._options,o;switch(e.type){case"ortchange":this.refresh();break;case"touchmove":s.scrollMove&&e.preventDefault();break;case"click":if(s._mask&&(t.contains(s._mask[0],e.target)||s._mask[0]===e.target))return n.trigger("maskClick");i=s._wrap.get(0),(r=t(e.target).closest(".ui-dialog-close",i))&&r.length?n.close():(r=t(e.target).closest(".ui-dialog-btns .ui-btn",i))&&r.length&&(o=s.buttons[r.attr("data-key")],o&&o.apply(n,arguments))}},_calculate:function(){var e=this,n=e._options,r,i,s=document.body,o={},u=n._cIsBody,a=Math.round;return n.mask&&(o.mask=u?{width:"100%",height:Math.max(s.scrollHeight,s.clientHeight)-1}:{width:"100%",height:"100%"}),r=n._wrap.offset(),i=t(window),o.wrap={left:"50%",marginLeft:-a(r.width/2)+"px",top:u?a(i.height()/2)+window.pageYOffset:"50%",marginTop:-a(r.height/2)+"px"},o},refresh:function(){var e=this,n=e._options,r,i;return n._isOpen&&(i=function(){r=e._calculate(),r.mask&&n._mask.css(r.mask),n._wrap.css(r.wrap)},t.os.ios&&document.activeElement&&/input|textarea|select/i.test(document.activeElement.tagName)?(document.body.scrollLeft=0,setTimeout(i,200)):i()),e},open:function(e,r){var i=this._options;return i._isOpen=!0,i._wrap.css("display","block"),i._mask&&i._mask.css("display","block"),e!==n&&this.position?this.position(e,r):this.refresh(),t(document).on("touchmove",t.proxy(this._eventHandler,this)),this.trigger("open")},close:function(){var e,n=this._options;return e=t.Event("beforeClose"),this.trigger(e),e.defaultPrevented?this:(n._isOpen=!1,n._wrap.css("display","none"),n._mask&&n._mask.css("display","none"),t(document).off("touchmove",this._eventHandler),this.trigger("close"))},title:function(e){var t=this._options,r=e!==n;return r&&(e=(t.title=e)?"<h3>"+e+"</h3>":e,t._title.html(e)[e?"prependTo":"remove"](t._wrap),t._close&&t._close.prependTo(t.title?t._title:t._wrap)),r?this:t.title},content:function(e){var t=this._options,r=e!==n;return r&&t._content.empty().append(t.content=e),r?this:t.content},destroy:function(){var e=this._options,n=this._eventHandler;return t(window).off("ortchange",n),t(document).off("touchmove",n),e._wrap.off("click",n).remove(),e._mask&&e._mask.off("click",n).remove(),e._close&&e._close.highlight(),this.$super("destroy")}})})(gmu,gmu.$);