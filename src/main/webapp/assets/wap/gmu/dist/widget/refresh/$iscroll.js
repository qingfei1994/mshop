(function(e,t,n){e.Refresh.register("iscroll",{_init:function(){var e=this,n=e._options,r=e.$el,i=r.height();t.extend(n,{useTransition:!0,speedScale:1,topOffset:n.$upElem?n.$upElem.height():0}),n.threshold=n.threshold||5,r.wrapAll(t('<div class="ui-refresh-wrapper"></div>').height(i)).css("height","auto"),e.on("ready",function(){e._loadIscroll()})},_changeStyle:function(e,t){var n=this,r=n._options,i=r.refreshInfo[e];n.origin(e,t);switch(t){case"loaded":i.$icon.addClass("ui-refresh-icon");break;case"beforeload":i.$label.html("松开立即加载"),i.$icon.addClass("ui-refresh-flip");break;case"loading":i.$icon.removeClass().addClass("ui-loading")}return n},_loadIscroll:function(){var e=this,n=e._options,r=n.threshold;n.iScroll=new iScroll(e.$el.parent().get(0),n.iScrollOpts=t.extend({useTransition:n.useTransition,speedScale:n.speedScale,topOffset:n.topOffset},n.iScrollOpts,{onScrollStart:function(t){e.trigger("scrollstart",t)},onScrollMove:function(){var t=n.$upElem&&n.$upElem.length,i=n.$downElem&&n.$downElem.length;return function(s){var o=n._upRefreshed,u=n._downRefreshed,a=e._status("up"),f=e._status("down");if(t&&!a||i&&!f||this.maxScrollY>=0)return;f&&i&&!u&&this.y<this.maxScrollY-r?e._setMoveState("down","beforeload","pull"):a&&t&&!o&&this.y>r?(e._setMoveState("up","beforeload","pull"),this.minScrollY=0):f&&u&&this.y>this.maxScrollY+r?e._setMoveState("down","loaded","restore"):a&&o&&this.y<r&&(e._setMoveState("up","loaded","restore"),this.minScrollY=-n.topOffset),e.trigger("scrollmove",s)}}(),onScrollEnd:function(t){var r=n._actDir;r&&e._status(r)&&(e._setStyle(r,"loading"),e._loadingAction(r,"pull")),e.trigger("scrollend",t)}}))},_setMoveState:function(e,t,n){var r=this,i=r._options;return r._setStyle(e,t),i["_"+e+"Refreshed"]=n=="pull",i._actDir=n=="pull"?e:"",r},afterDataLoading:function(e){var t=this,n=t._options,e=e||n._actDir;return n.iScroll.refresh(),n["_"+e+"Refreshed"]=!1,t.origin(e)}})})(gmu,gmu.$);